## InnoDB 四种行格式

- COMPACT
- REDUNDANT （比较古老，占用空间大）
- DYNAMIC
- COMPRESSED （压缩格式）

## MySQL为每个记录默认添加的列

| 列名        | 是否必须 | 占用空间 | 描述                    |
| ----------- | -------- | -------- | ----------------------- |
| DB_ROW_ID   | 否       | 6 字节   | 行 ID，唯一标识一条记录 |
| DB_TRX_ID   | 是       | 6 字节   | 事务 ID                 |
| DB_ROLL_PTR | 是       | 7 字节   | 回滚指针                |

InnoDB 主键生成策略：

- 优先使用用户定义的主键
- 若用户未定义主键，选择一个不允许 NULL 的 UNIQUE 键作为主键
- 都没有定义，则添加 DB_ROW_ID 作为主键

## CHAR(M)列的存储格式

- 使用空格字符填充剩余的空间
- 采用的字符集若为定长的（例如 ASCII），则作为定长字段看待，分配 M * W（W 为字符集占用字节数）字节存储
- 采用的 字符集为变长的（例如 UTF-8），则视为变长字段，该列的值占用的字节数存到变长字段长度列表中
- 采用变长字符集编码时，至少占用 M 字节（而 VARCHAR(M)没有这个要求），例如 UTF-8 字符集长度为 1-3，因此 CHAR(10)可能占用的长度为 10-30，应至少分配 10 字节，这是为了当新值长度大于旧值但小于等于 10 字节时不会导致重新分配空间（性能、空间的折中）

## 溢出列

- 行格式为 COMPACT：真实数据记录保存前768 字节，然后用 20 字节保存溢出页地址
- 行格式为DYNAMIC和COMPRESSED：真实记录只保存 20 字节的溢出页地址，所有数据保存在溢出页中